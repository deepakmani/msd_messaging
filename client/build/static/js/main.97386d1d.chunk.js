(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAAlwSFlzAAAphgAAKYYBIuzfjAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAchJREFUKBV9UjFLHEEU/mZ219M7Q0rrWCoRAzaS5oKnSKp0lvYK2p4guF26FIGDSFJa6A8wAS2SEE0RNDZaJIVaSoIGRD3vZmcm35vdOwgceTDzZt9833vfznuAWJrq4Dvbeu0h3k4N4dXkQCdEr5Cii+MHSWnqAqAxPQPv5wl5DI8y/RXgvyKL3mF55zhghJzCqW7GRu0llKqjPwKsz8NyG7FI0zCBWsbC7ka48FBE0Rq1NVSSVVgWbrkMznuS82WcRX88iMy9wPNH3/H+7CdUNVZ4Mz1B0B5iXYJxbcpLQjKpFgor7t6gnJRwZ45gkyqWPlxrkuZCMHOmIAlFkZR7eM1zhPtMok8QtWcksbzSOKXJWYC9TSkd5PfJn+kxAQmx0tEkgd7mc+GKzvsHghHin6JY8ZQ9qSKc8gXiic+J36CDyv8RLTEKLWtJOciJym7iln0qRfKaba6Qtus9ZDgcBmK5+YJRs8NvSl34+IP7SoD3RSXGmLUAi5f3rbAVN+aS8DqefcqQVuN8ALZPDzE7fMEBeMrMFfZUh5UUvmlOoPQ8Fnf3w7ym5/bfWX09NcLqcxy9CeoaZIVf9J/Z9C02/TeVSP2w/wUqsacLZFajbwAAAABJRU5ErkJggg=="},19:function(e,t,s){e.exports=s(32)},24:function(e,t,s){},26:function(e,t,s){e.exports=s.p+"static/media/logo.5d5d9eef.svg"},27:function(e,t,s){},32:function(e,t,s){"use strict";s.r(t);var a=s(0),n=s.n(a),r=s(13),c=s.n(r),i=(s(24),s(6)),m=s(7),l=s(10),u=s(8),o=s(9),d=s(3),g=(s(26),s(15)),h=s.n(g),p=(s(27),s(18)),_=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).scrollToBottom=function(){e.messagesEnd.scrollIntoView({behavior:"smooth"})},e.first_message_dates={},e.state={new_message:"",direct_messages:[],messages:[{sender_username:"deepakabs",sentAt:"Wed Nov 20, 2018 at 11",message:"1"},{sender_username:"deepakabs",senderName:"Deepak ABS",profile_img_url:"abs",sentAt:"Wed Nov 20, 2018 at 11",message:"2"},{sender_username:"deepakabs",senderName:"Deepak ABS",profile_img_url:"abs",sentAt:"Wed Nov 20, 2018 at 11",message:"3"},{sender_username:"deepakabs",senderName:"Deepak ABS",profile_img_url:"abs",sentAt:"Wed Nov 20, 2018 at 11",message:"4"}]},e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.send_direct_message=e.send_direct_message.bind(Object(d.a)(Object(d.a)(e))),e.update_first_message_date=e.update_first_message_date.bind(Object(d.a)(Object(d.a)(e))),e}return Object(o.a)(t,e),Object(m.a)(t,[{key:"update_first_message_date",value:function(e,t){this.first_message_dates[e]=t}},{key:"componentDidMount",value:function(){this.scrollToBottom(),this.getDirectMessages(this.props.current_user.username,this.props.selected_user.username)}},{key:"getDirectMessages",value:function(e,t){var s=this;return this.first_message_dates={},this.setState({fetching_direct_messages:!0}),fetch("/api/getDirectMessages?username1="+e+"&username2="+t).then(function(e){return e.json()}).then(function(e){var t=e.map(function(e){var t=new Date(e.createdAt);return s.first_message_dates[t.toDateString()]||(s.first_message_dates[t.toDateString()]=e.id),e.sent=!0,e});s.setState({direct_messages:t,fetching_direct_messages:!1})}).catch(function(e){s.setState({fetching_direct_messages:!1})})}},{key:"componentWillReceiveProps",value:function(e){e&&void 0!=e.selected_user&&void 0!=e.current_user&&(this.props.current_user.username==e.current_user.username&&this.props.selected_user.username==e.selected_user.username||this.getDirectMessages(e.current_user.username,e.selected_user.username))}},{key:"componentDidUpdate",value:function(e){this.scrollToBottom()}},{key:"send_direct_message",value:function(e){var t=this;e.preventDefault();var s=new Date,a=s.toDateString(),n=this.state.new_message,r={};if(n=n.trim()){var c=s.getTime();(r={message:n,sender_username:this.props.current_user.username,id:c+"_"+this.props.current_user.username,receiver_username:this.props.selected_user.username,sent:!1,read:!1,display_date:!(a in this.first_message_dates),date_string:a}).display_date&&(this.first_message_dates[a]=!1),this.setState({direct_messages:Object(p.a)(this.state.direct_messages).concat([r])}),fetch("/api/sendDirectMessage",{method:"POST",body:JSON.stringify({direct_message:r}),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.sent&&t.setState({direct_messages:t.state.direct_messages.map(function(t){return t.id===e.id?Object.assign({},t,{sent:!0,createdAt:e.createdAt}):t})})}).catch(function(e){})}}},{key:"handleChange",value:function(e){e.preventDefault(),this.setState({new_message:e.target.value})}},{key:"render",value:function(){var e=this;return n.a.createElement(n.a.Fragment,{key:this.props.current_user},n.a.createElement("div",{className:"direct-message-header"},n.a.createElement("span",null," Send Message To  ",this.props.selected_user.name," ")),n.a.createElement("div",{className:"direct-message-history-wrapper"},n.a.createElement("div",{className:"direct-message-history"},!this.state.fetching_direct_messages&&n.a.createElement("div",null,this.state.direct_messages.map(function(t){return n.a.createElement(f,{key:t.id,message:t,current_user:e.props.current_user,selected_user:e.props.selected_user,update_first_message_date:e.update_first_message_date,first_message_dates:e.first_message_dates}," ")})),n.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),n.a.createElement("hr",null),n.a.createElement("form",{onSubmit:this.send_direct_message},n.a.createElement("label",null,n.a.createElement("textarea",{className:"send-message-textarea",value:this.state.new_message,onChange:this.handleChange})),n.a.createElement("input",{className:"mdl-button mdl-button--primary mdl-button--raised",type:"submit",value:"Send"}))))}}]),t}(a.Component),f=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this))}return Object(o.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e,t="";if(this.props.message.sent){if(this.props.message.sent&&!this.props.message.read){var s=new Date(this.props.message.createdAt);s=s.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),t=n.a.createElement("span",{style:{color:"#12B",float:"right","font-size":"10px"}}," Sent at ",s," ")}else if(this.props.message.sent&&this.props.message.read){var a=new Date(this.props.message.updatedAt);a=a.toLocaleTimeString(),t=n.a.createElement("span",{style:{color:"#090",float:"right","font-size":"10px"}}," Seen at ",a," ")}}else t=n.a.createElement("span",{style:{color:"#423",float:"right","font-size":"10px"}}," Sending... ");var r=this.props.message.date_string?this.props.message.date_string:new Date(this.props.message.createdAt).toDateString();return this.props.message.display_date&&0==this.props.first_message_dates[r]&&!this.props.message.sent&&(e=n.a.createElement("div",{style:{"text-align":"center","font-size":"15px"}}," ",r," "),this.props.update_first_message_date(r,this.props.message.id)),this.props.message.sent&&this.props.first_message_dates[r]==this.props.message.id&&(e=n.a.createElement("div",{style:{"text-align":"center","font-size":"15px"}}," ",r," ")),this.props.current_user.username==this.props.message.sender_username?n.a.createElement(n.a.Fragment,null,e,n.a.createElement("br",null),n.a.createElement("ul",{className:"sent-message-ul"},n.a.createElement("li",null,this.props.current_user.profile_image_url,n.a.createElement("br",null),"You"),n.a.createElement("li",null,n.a.createElement("span",{className:"sent-message"},this.props.message.message),n.a.createElement("br",null),n.a.createElement("br",null),t))):this.props.selected_user.username==this.props.message.sender_username?n.a.createElement(n.a.Fragment,null,e,n.a.createElement("br",null),n.a.createElement("ul",{className:"received-message-ul"},n.a.createElement("li",null,n.a.createElement("img",{style:{height:"30px",width:"30px"},src:this.props.selected_user.profile_img_url}),n.a.createElement("br",null),this.props.selected_user.name),n.a.createElement("li",null,n.a.createElement("span",{className:"sent-message"},this.props.message.message),n.a.createElement("br",null),n.a.createElement("br",null),t))):void 0}}]),t}(a.Component),b=s(33),v=s(34),A=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e))).selected_member_to_message={username:"deepakabs"},s.router=void 0,s.state={users:[],fetching_members:!1,fetched_members_success:!0,current_user:{username:"DeepakABS"},members:[],selected_member_status:"All",member_statuses:["All","Online","Away","Offline"],test:1,active_nav:""},s.selectMemberToMessage=s.selectMemberToMessage.bind(Object(d.a)(Object(d.a)(s))),s.selectCurrentUser=s.selectCurrentUser.bind(Object(d.a)(Object(d.a)(s))),s}return Object(o.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({fetching_members:!0}),this.fetchUsers().then(function(t){return e.setState({test:3,users:t,current_user:t[0]}),e.fetchDirectMessageCountForUser(e.state.current_user)}).then(function(t){e.setState({members:t,fetching_members:!1},function(){e.selectMemberToMessage(void 0,e.state.members[0])})}).catch(function(t){e.setState({fetching_members:!1,fetched_members_success:!1})})}},{key:"fetchUsers",value:function(){return fetch("/api/getUsers/").then(function(e){return e.json()})}},{key:"fetchDirectMessageCountForUser",value:function(e){var t=encodeURIComponent(e.username),s=encodeURIComponent(e.company);return fetch("/api/getDirectMessagesCountForUser?username="+t+"&company="+s).then(function(e){return e.json()})}},{key:"selectCurrentUser",value:function(e){var t=this,s=e.target.value,a={};this.state.users.forEach(function(e){e.username==s&&Object.assign(a,e)}),this.setState({fetching_members:!0,current_user:a}),this.fetchDirectMessageCountForUser(a).then(function(s){t.setState({members:s,fetching_members:!1},function(){t.selectMemberToMessage(e,t.state.members[0])})}).catch(function(e){t.setState({fetching_members:!1,fetched_members_success:!1})})}},{key:"selectMemberToMessage",value:function(e,t){var s=this;this.selected_member_to_message=t,this.setState({members:this.state.members.map(function(e){return e.username===t.username?Object.assign({},e,{isActive:!0}):Object.assign({},e,{isActive:!1})})},function(){return s.router.history.push("/directMessage")}),fetch("/api/markMessagesAsRead?receiver_username="+this.state.current_user.username+"&sender_username="+this.selected_member_to_message.username).then(function(){s.setState({members:s.state.members.map(function(e){return e.username===s.selected_member_to_message.username?Object.assign({},e,{new_msg_count:null}):Object.assign({},e,{new_msg_count:e.new_msg_count})})})})}},{key:"render",value:function(){var e,t=this;return this.state.fetching_members?e=n.a.createElement("div",{style:{"text-align":"center"}},n.a.createElement("i",{className:"fa fa-spinner fa-pulse fa-2x fa-fw"})):this.state.fetched_members_success?e=this.state.members.map(function(e){return n.a.createElement("tr",{key:e.username,className:e.isActive?"active-nav":"default-nav",onClick:function(s){return t.selectMemberToMessage(s,e)}},n.a.createElement("td",null," ",n.a.createElement("img",{src:e.profile_img_url,style:{height:"30px",width:"30px"}})," "),n.a.createElement("td",null," ",e.name," "),n.a.createElement("td",{style:{color:"#FF4081"}}," ",e.new_msg_count?e.new_msg_count:"","  "),n.a.createElement("td",null," ",n.a.createElement("img",{src:h.a})," "))}):(e=n.a.createElement("h4",null," Unable to get members "),e+=n.a.createElement("button",null," Retry ")),n.a.createElement(v.a,{ref:function(e){return t.router=e}},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"mdl-grid"},n.a.createElement("div",{className:"mdl-cell mdl-cell--3-col nav"},n.a.createElement("div",{className:"direct-messages"},n.a.createElement("h4",{style:{"font-size":"18px",background:"none",border:"none"}}," Select User ")),n.a.createElement("select",{style:{background:"#FFF",padding:"10px"},className:"mdl-textfield__input",value:this.state.current_user.username,onChange:this.selectCurrentUser},this.state.users.map(function(e){return n.a.createElement("option",{key:e.username,name:e.username,value:e.username}," ",e.name," ")})),n.a.createElement("div",{className:"direct-messages"},n.a.createElement("h4",null," Direct Messages "),n.a.createElement("table",{cellspacing:"0",cellpadding:"0"},n.a.createElement("tbody",null,e)))),n.a.createElement("div",{className:"mdl-cell mdl-cell--8-col"},n.a.createElement(b.a,{exact:!0,path:"/directMessage/",render:function(e){return n.a.createElement(_,Object.assign({},e,{current_user:t.state.current_user,selected_user:t.selected_member_to_message}))}}),";"))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var E=s(35);c.a.render(n.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()});t.default=Object(E.a)(A)}},[[19,2,1]]]);
//# sourceMappingURL=main.97386d1d.chunk.js.map