{"ast":null,"code":"import _toConsumableArray from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/deepakabs/programming/node_projects/msd_messaging/client/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/deepakabs/programming/node_projects/msd_messaging/client/src/components/DirectMessage.js\";\nimport React, { Component } from 'react';\nexport var DirectMessage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(DirectMessage, _Component);\n\n  function DirectMessage() {\n    var _this;\n\n    _classCallCheck(this, DirectMessage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DirectMessage).call(this)); // Hash dates to display above first message of day to show date is displayed\n\n    _this.scrollToBottom = function () {\n      _this.messagesEnd.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    };\n\n    _this.first_message_dates = {};\n    _this.state = {\n      // Message to send\n      new_message: \"\",\n      // List of Messages\n      direct_messages: [],\n      messages: [{\n        sender_username: \"deepakabs\",\n        sentAt: \"Wed Nov 20, 2018 at 11\",\n        message: \"1\"\n      }, {\n        sender_username: \"deepakabs\",\n        senderName: \"Deepak ABS\",\n        profile_img_url: \"abs\",\n        sentAt: \"Wed Nov 20, 2018 at 11\",\n        message: \"2\"\n      }, {\n        sender_username: \"deepakabs\",\n        senderName: \"Deepak ABS\",\n        profile_img_url: \"abs\",\n        sentAt: \"Wed Nov 20, 2018 at 11\",\n        message: \"3\"\n      }, {\n        sender_username: \"deepakabs\",\n        senderName: \"Deepak ABS\",\n        profile_img_url: \"abs\",\n        sentAt: \"Wed Nov 20, 2018 at 11\",\n        message: \"4\"\n      }] // Bind to class         \n\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.send_direct_message = _this.send_direct_message.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.update_first_message_date = _this.update_first_message_date.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n  /* @name:  \tupdate_first_message_date()\n  @descr: Show first message with date \n  */\n\n\n  _createClass(DirectMessage, [{\n    key: \"update_first_message_date\",\n    value: function update_first_message_date(date_str, id) {\n      this.first_message_dates[date_str] = id;\n    }\n    /* @name:  \tcomponentDidMount()\n    @descr: fetch messages between selected user and current user\n    */\n\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Show loading \n      this.scrollToBottom(); //  this.setState({fetching_direct_messages: true});\n      // Collect Messages\n\n      this.getDirectMessages(this.props.current_user.username, this.props.selected_user.username);\n    }\n    /*\n    \t@name:getDirectMessages\n    \t@descr: Make GET request to getDirectMessages\n    */\n\n  }, {\n    key: \"getDirectMessages\",\n    value: function getDirectMessages(username1, username2) {\n      var _this2 = this;\n\n      this.first_message_dates = {};\n      this.setState({\n        fetching_direct_messages: true\n      });\n      var api = \"/api/getDirectMessages?username1=\" + username1 + \"&username2=\" + username2;\n      return fetch(api).then(function (response) {\n        return response.json();\n      }).then(function (direct_messages) {\n        // 2. Update firstMessageDay hash\n        var updated_direct_messages = direct_messages.map(function (dm) {\n          var date = new Date(dm.createdAt);\n          if (!_this2.first_message_dates[date.toDateString()]) _this2.first_message_dates[date.toDateString()] = dm.id;\n          dm.sent = true;\n          return dm;\n        }); // 3.Update state\n\n        _this2.setState({\n          direct_messages: updated_direct_messages,\n          fetching_direct_messages: false\n        });\n      }).catch(function (err) {\n        _this2.setState({\n          //   direct_messages:     updated_direct_messages,\n          fetching_direct_messages: false\n        });\n      });\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps && nextProps.selected_user != undefined && nextProps.current_user != undefined) {\n        if (this.props.current_user.username != nextProps.current_user.username || this.props.selected_user.username != nextProps.selected_user.username) {\n          // Collect Messages\n          this.getDirectMessages(nextProps.current_user.username, nextProps.selected_user.username);\n        }\n      } //this.scrollToBottom();\n\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // if (prevProps && prevProps.selected_user != undefined &&  prevProps.current_user != undefined) {\n      // \tif ((this.props.current_user.username != prevProps.current_user.username) || \n      // \t\t (this.props.selected_user.username != prevProps.selected_user.username))\n      // \t{\n      // \t\t // Collect Messages\n      // \t     this.getDirectMessages(this.props.current_user.username, this.props.selected_user.username)\n      // \t}\n      // }\n      this.scrollToBottom();\n    }\n    /* @name: send_direct_message \n       @descr: Send the message to the db and update the status\n    */\n\n  }, {\n    key: \"send_direct_message\",\n    value: function send_direct_message(event) {\n      var _this3 = this;\n\n      event.preventDefault();\n      console.log(\"Nemam Amma Bhagavan Sharanam -- send_direct_message\", this.props.selected_user.username); // 1. Create message object\n\n      var date = new Date();\n      var date_str = date.toDateString();\n      var message = this.state.new_message;\n      message = message.trim();\n      var direct_message = {};\n\n      if (message) {\n        var timestamp = date.getTime();\n        direct_message = {\n          message: message,\n          sender_username: this.props.current_user.username,\n          id: timestamp + \"_\" + this.props.current_user.username,\n          receiver_username: this.props.selected_user.username,\n          // Boolean indicating if message is sent\n          sent: false,\n          read: false,\n          // Display date for the first message in a day\n          display_date: !(date_str in this.first_message_dates) ? true : false,\n          date_string: date_str\n        }; // Update sent_dates_list\n\n        if (direct_message.display_date) {\n          console.log(\"Nemam Amma Bhagavan Sharanam -- setting first message date\");\n          this.first_message_dates[date_str] = false;\n        }\n\n        this.setState({\n          direct_messages: _toConsumableArray(this.state.direct_messages).concat([direct_message])\n        });\n        fetch(\"/api/sendDirectMessage\", {\n          method: 'POST',\n          // or 'PUT'\n          body: JSON.stringify({\n            direct_message: direct_message\n          }),\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        }).then(function (response) {\n          return response.json();\n        }).then(function (data) {\n          console.log(\"Nemam Amma Bhagavan Sharanam -- sent data\", data); // If message is delivered\n\n          if (data.sent) {\n            // Update message with status\n            _this3.setState({\n              direct_messages: _this3.state.direct_messages.map(function (el) {\n                return el.id === data.id ? Object.assign({}, el, {\n                  sent: true,\n                  createdAt: data.createdAt\n                }) : el;\n              })\n            });\n          }\n        }) // Don't modify the messages\n        .catch(function (err) {}); // Save the new message in database\n        // Update sent status \n      }\n    }\n    /* @name: handleChange: \n       @descr: Update text field when user modifies it\n    */\n\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(event) {\n      event.preventDefault();\n      this.setState({\n        new_message: event.target.value\n      });\n    } // Scroll to bottom\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return React.createElement(React.Fragment, {\n        key: this.props.current_user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"direct-message-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, \" Send Message To  \", this.props.selected_user.name, \" \")), React.createElement(\"div\", {\n        className: \"direct-message-history-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"direct-message-history\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, !this.state.fetching_direct_messages && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }, this.state.direct_messages.map(function (message) {\n        return React.createElement(Message, {\n          key: message.id,\n          message: message,\n          current_user: _this4.props.current_user,\n          selected_user: _this4.props.selected_user,\n          update_first_message_date: _this4.update_first_message_date,\n          first_message_dates: _this4.first_message_dates,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 242\n          },\n          __self: this\n        }, \" \");\n      })), React.createElement(\"div\", {\n        style: {\n          float: \"left\",\n          clear: \"both\"\n        },\n        ref: function ref(el) {\n          _this4.messagesEnd = el;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      })), React.createElement(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }), React.createElement(\"form\", {\n        onSubmit: this.send_direct_message,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }, React.createElement(\"textarea\", {\n        className: \"send-message-textarea\",\n        value: this.state.new_message,\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      })), React.createElement(\"input\", {\n        className: \"mdl-button mdl-button--primary mdl-button--raised\",\n        type: \"submit\",\n        value: \"Send\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return DirectMessage;\n}(Component);\n\nvar Message =\n/*#__PURE__*/\nfunction (_Component2) {\n  _inherits(Message, _Component2);\n\n  function Message() {\n    _classCallCheck(this, Message);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Message).call(this));\n  }\n\n  _createClass(Message, [{\n    key: \"render\",\n    value: function render() {\n      // Sending / Sent / Seen\n      var status = \"\"; // If message is first\n\n      var firstMessageDate; // If message is sent\n\n      if (!this.props.message.sent) {\n        status = React.createElement(\"span\", {\n          style: {\n            color: '#423',\n            float: 'right',\n            'font-size': '10px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 283\n          },\n          __self: this\n        }, \" Sending... \");\n      } // If message is sent but unread\n      else if (this.props.message.sent && !this.props.message.read) {\n          // Convert Date to hours minutes\n          var date = new Date(this.props.message.createdAt);\n          date = date.toLocaleTimeString(navigator.language, {\n            hour: '2-digit',\n            minute: '2-digit'\n          });\n          status = React.createElement(\"span\", {\n            style: {\n              color: '#12B',\n              float: 'right',\n              'font-size': '10px'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 293\n            },\n            __self: this\n          }, \" Sent at \", date, \" \");\n        } else if (this.props.message.sent && this.props.message.read) {\n          var _date = new Date(this.props.message.updatedAt);\n\n          _date = _date.toDateString();\n          status = React.createElement(\"span\", {\n            style: {\n              color: '#ACB',\n              float: 'right',\n              'font-size': '10px'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 300\n            },\n            __self: this\n          }, \" Seen at \", _date, \" \");\n        } // Display Date for First Message of Day\n\n\n      var date_str = this.props.message.date_string ? this.props.message.date_string : new Date(this.props.message.createdAt).toDateString();\n\n      if (this.props.message.display_date && this.props.first_message_dates[date_str] == false && !this.props.message.sent) {\n        firstMessageDate = React.createElement(\"div\", {\n          style: {\n            \"text-align\": 'center',\n            'font-size': '15px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308\n          },\n          __self: this\n        }, \" \", date_str, \" \");\n        this.props.update_first_message_date(date_str, this.props.message.id);\n      }\n\n      if (this.props.message.sent && this.props.first_message_dates[date_str] == this.props.message.id) {\n        firstMessageDate = React.createElement(\"div\", {\n          style: {\n            \"text-align\": 'center',\n            'font-size': '15px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 314\n          },\n          __self: this\n        }, \" \", date_str, \" \");\n      }\n\n      if (this.props.current_user.username == this.props.message.sender_username) {\n        return (// If message is sent by user style it differently\n          React.createElement(React.Fragment, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 321\n            },\n            __self: this\n          }, firstMessageDate, React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 323\n            },\n            __self: this\n          }), React.createElement(\"ul\", {\n            className: \"sent-message-ul\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 324\n            },\n            __self: this\n          }, React.createElement(\"li\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 325\n            },\n            __self: this\n          }, this.props.current_user.profile_image_url, React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 327\n            },\n            __self: this\n          }), \"You\"), React.createElement(\"li\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 330\n            },\n            __self: this\n          }, React.createElement(\"span\", {\n            className: \"sent-message\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 331\n            },\n            __self: this\n          }, this.props.message.message), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 334\n            },\n            __self: this\n          }), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 335\n            },\n            __self: this\n          }), status)))\n        );\n      }\n\n      if (this.props.selected_user.username == this.props.message.sender_username) {\n        return (// If message is sent by user style it differently\n          React.createElement(React.Fragment, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 350\n            },\n            __self: this\n          }, firstMessageDate, React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 352\n            },\n            __self: this\n          }), React.createElement(\"ul\", {\n            className: \"received-message-ul\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 353\n            },\n            __self: this\n          }, React.createElement(\"li\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 354\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            style: {\n              height: \"30px\",\n              width: \"30px\"\n            },\n            src: this.props.selected_user.profile_img_url,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 355\n            },\n            __self: this\n          }), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 356\n            },\n            __self: this\n          }), this.props.selected_user.name), React.createElement(\"li\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 359\n            },\n            __self: this\n          }, React.createElement(\"span\", {\n            className: \"sent-message\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 360\n            },\n            __self: this\n          }, this.props.message.message), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 363\n            },\n            __self: this\n          }), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 364\n            },\n            __self: this\n          }), status)))\n        );\n      }\n    }\n  }]);\n\n  return Message;\n}(Component);","map":{"version":3,"sources":["/Users/deepakabs/programming/node_projects/msd_messaging/client/src/components/DirectMessage.js"],"names":["React","Component","DirectMessage","scrollToBottom","messagesEnd","scrollIntoView","behavior","first_message_dates","state","new_message","direct_messages","messages","sender_username","sentAt","message","senderName","profile_img_url","handleChange","bind","send_direct_message","update_first_message_date","date_str","id","getDirectMessages","props","current_user","username","selected_user","username1","username2","setState","fetching_direct_messages","api","fetch","then","response","json","updated_direct_messages","map","dm","date","Date","createdAt","toDateString","sent","catch","err","nextProps","undefined","prevProps","event","preventDefault","console","log","trim","direct_message","timestamp","getTime","receiver_username","read","display_date","date_string","method","body","JSON","stringify","headers","data","el","Object","assign","target","value","name","float","clear","Message","status","firstMessageDate","color","toLocaleTimeString","navigator","language","hour","minute","updatedAt","profile_image_url","height","width"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,WAAaC,aAAb;AAAA;AAAA;AAAA;;AACE,2BAAc;AAAA;;AAAA;;AACR,wFADQ,CAGR;;AAHQ,UA4NZC,cA5NY,GA4NK,YAAM;AACxB,YAAKC,WAAL,CAAiBC,cAAjB,CAAgC;AAAEC,QAAAA,QAAQ,EAAE;AAAZ,OAAhC;AACD,KA9Nc;;AAIT,UAAKC,mBAAL,GAA2B,EAA3B;AAGA,UAAKC,KAAL,GAAa;AACZ;AACAC,MAAAA,WAAW,EAAE,EAFD;AAIZ;AACDC,MAAAA,eAAe,EAAE,EALJ;AAMbC,MAAAA,QAAQ,EAAE,CAAC;AAACC,QAAAA,eAAe,EAAI,WAApB;AACRC,QAAAA,MAAM,EAAI,wBADF;AAERC,QAAAA,OAAO,EAAI;AAFH,OAAD,EAIN;AAACF,QAAAA,eAAe,EAAQ,WAAxB;AACDG,QAAAA,UAAU,EAAG,YADZ;AAEDC,QAAAA,eAAe,EAAE,KAFhB;AAGDH,QAAAA,MAAM,EAAI,wBAHT;AAIDC,QAAAA,OAAO,EAAI;AAJV,OAJM,EAWN;AAACF,QAAAA,eAAe,EAAI,WAApB;AACDG,QAAAA,UAAU,EAAG,YADZ;AAEDC,QAAAA,eAAe,EAAE,KAFhB;AAGDH,QAAAA,MAAM,EAAI,wBAHT;AAIDC,QAAAA,OAAO,EAAI;AAJV,OAXM,EAiBN;AAACF,QAAAA,eAAe,EAAQ,WAAxB;AACDG,QAAAA,UAAU,EAAG,YADZ;AAEDC,QAAAA,eAAe,EAAE,KAFhB;AAGDH,QAAAA,MAAM,EAAI,wBAHT;AAIDC,QAAAA,OAAO,EAAI;AAJV,OAjBM,CANG,CA+BZ;;AA/BY,KAAb;AAgCC,UAAKG,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,uDAApB;AACH,UAAKC,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBD,IAAzB,uDAA3B;AACA,UAAKE,yBAAL,GAAiC,MAAKA,yBAAL,CAA+BF,IAA/B,uDAAjC;AAzCW;AA0CX;AAED;;;;;AA7CJ;AAAA;AAAA,8CAgD4BG,QAhD5B,EAgDsCC,EAhDtC,EAgD0C;AACtC,WAAKf,mBAAL,CAAyBc,QAAzB,IAAqCC,EAArC;AAED;AACC;;;;AApDJ;AAAA;AAAA,wCAuDuB;AACjB;AACA,WAAKnB,cAAL,GAFiB,CAInB;AAEE;;AACA,WAAKoB,iBAAL,CAAuB,KAAKC,KAAL,CAAWC,YAAX,CAAwBC,QAA/C,EAAyD,KAAKF,KAAL,CAAWG,aAAX,CAAyBD,QAAlF;AAGD;AAED;;;;;AAnEJ;AAAA;AAAA,sCAuEqBE,SAvErB,EAuEgCC,SAvEhC,EAuE2C;AAAA;;AAEzC,WAAKtB,mBAAL,GAA2B,EAA3B;AAEC,WAAKuB,QAAL,CAAc;AACLC,QAAAA,wBAAwB,EAAE;AADrB,OAAd;AAGA,UAAIC,GAAG,GAAG,sCAAuCJ,SAAvC,GAAmD,aAAnD,GAAmEC,SAA7E;AACA,aAAOI,KAAK,CAACD,GAAD,CAAL,CACNE,IADM,CACD,UAAAC,QAAQ;AAAA,eAAKA,QAAQ,CAACC,IAAT,EAAL;AAAA,OADP,EAENF,IAFM,CAED,UAACxB,eAAD,EAAqB;AAG1B;AACA,YAAK2B,uBAAuB,GAAG3B,eAAe,CAAC4B,GAAhB,CAAoB,UAACC,EAAD,EAAQ;AAC1D,cAAIC,IAAI,GAAG,IAAIC,IAAJ,CAASF,EAAE,CAACG,SAAZ,CAAX;AACA,cAAI,CAAC,MAAI,CAACnC,mBAAL,CAAyBiC,IAAI,CAACG,YAAL,EAAzB,CAAL,EACC,MAAI,CAACpC,mBAAL,CAAyBiC,IAAI,CAACG,YAAL,EAAzB,IAAgDJ,EAAE,CAACjB,EAAnD;AACDiB,UAAAA,EAAE,CAACK,IAAH,GAAU,IAAV;AACA,iBAAOL,EAAP;AACA,SAN8B,CAA/B,CAJ0B,CAY1B;;AACI,QAAA,MAAI,CAACT,QAAL,CAAc;AACVpB,UAAAA,eAAe,EAAM2B,uBADX;AAEVN,UAAAA,wBAAwB,EAAE;AAFhB,SAAd;AAKD,OApBG,EAqBRc,KArBQ,CAqBF,UAACC,GAAD,EAAS;AACR,QAAA,MAAI,CAAChB,QAAL,CAAc;AACZ;AACEC,UAAAA,wBAAwB,EAAE;AAFhB,SAAd;AAIH,OA1BI,CAAP;AA4BC;AA3GJ;AAAA;AAAA,8CA6G6BgB,SA7G7B,EA6GwC;AAEtC,UAAIA,SAAS,IAAIA,SAAS,CAACpB,aAAV,IAA2BqB,SAAxC,IAAsDD,SAAS,CAACtB,YAAV,IAA0BuB,SAApF,EAA+F;AAC9F,YAAK,KAAKxB,KAAL,CAAWC,YAAX,CAAwBC,QAAxB,IAAoCqB,SAAS,CAACtB,YAAV,CAAuBC,QAA5D,IACD,KAAKF,KAAL,CAAWG,aAAX,CAAyBD,QAAzB,IAAqCqB,SAAS,CAACpB,aAAV,CAAwBD,QADhE,EAEA;AACE;AACG,eAAKH,iBAAL,CAAuBwB,SAAS,CAACtB,YAAV,CAAuBC,QAA9C,EAAwDqB,SAAS,CAACpB,aAAV,CAAwBD,QAAhF;AAEJ;AACD,OAVqC,CAWrC;;AACD;AAzHF;AAAA;AAAA,uCA0HsBuB,SA1HtB,EA0HiC;AAC/B;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACC,WAAK9C,cAAL;AACD;AAGE;;;;AAxIJ;AAAA;AAAA,wCA2IuB+C,KA3IvB,EA2I8B;AAAA;;AACzBA,MAAAA,KAAK,CAACC,cAAN;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,qDAAZ,EAAmE,KAAK7B,KAAL,CAAWG,aAAX,CAAyBD,QAA5F,EAFyB,CAGzB;;AACA,UAAIc,IAAI,GAAK,IAAIC,IAAJ,EAAb;AACA,UAAIpB,QAAQ,GAAImB,IAAI,CAACG,YAAL,EAAhB;AACA,UAAI7B,OAAO,GAAI,KAAKN,KAAL,CAAWC,WAA1B;AACGK,MAAAA,OAAO,GAAGA,OAAO,CAACwC,IAAR,EAAV;AACA,UAAIC,cAAc,GAAG,EAArB;;AACH,UAAIzC,OAAJ,EAAa;AAEX,YAAI0C,SAAS,GAAIhB,IAAI,CAACiB,OAAL,EAAjB;AACGF,QAAAA,cAAc,GAAG;AACCzC,UAAAA,OAAO,EAAGA,OADX;AAECF,UAAAA,eAAe,EAAI,KAAKY,KAAL,CAAWC,YAAX,CAAwBC,QAF5C;AAGCJ,UAAAA,EAAE,EAAQkC,SAAS,GAAG,GAAZ,GAAkB,KAAKhC,KAAL,CAAWC,YAAX,CAAwBC,QAHrD;AAICgC,UAAAA,iBAAiB,EAAE,KAAKlC,KAAL,CAAWG,aAAX,CAAyBD,QAJ7C;AAMC;AACAkB,UAAAA,IAAI,EAAI,KAPT;AAQCe,UAAAA,IAAI,EAAG,KARR;AASC;AACAC,UAAAA,YAAY,EAAE,EAAEvC,QAAQ,IAAI,KAAKd,mBAAnB,IAA0C,IAA1C,GAAiD,KAVhE;AAWCsD,UAAAA,WAAW,EAAGxC;AAXf,SAAjB,CAHQ,CAiBV;;AACA,YAAIkC,cAAc,CAACK,YAAnB,EAAiC;AAChCR,UAAAA,OAAO,CAACC,GAAR,CAAa,4DAAb;AACA,eAAK9C,mBAAL,CAAyBc,QAAzB,IAAqC,KAArC;AACA;;AAED,aAAKS,QAAL,CAAc;AACfpB,UAAAA,eAAe,qBAAM,KAAKF,KAAL,CAAWE,eAAjB,UAAkC6C,cAAlC;AADA,SAAd;AAIAtB,QAAAA,KAAK,CAAC,wBAAD,EAA2B;AACnC6B,UAAAA,MAAM,EAAE,MAD2B;AACnB;AAChBC,UAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAACV,YAAAA,cAAc,EAAEA;AAAjB,WAAf,CAF6B;AAGnCW,UAAAA,OAAO,EAAE;AACE,4BAAgB;AADlB;AAH0B,SAA3B,CAAL,CAOJhC,IAPI,CAOC,UAACC,QAAD;AAAA,iBAAaA,QAAQ,CAACC,IAAT,EAAb;AAAA,SAPD,EAQJF,IARI,CAQC,UAACiC,IAAD,EAAU;AAEff,UAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ,EAAyDc,IAAzD,EAFe,CAGf;;AACA,cAAIA,IAAI,CAACvB,IAAT,EAAe;AACd;AACC,YAAA,MAAI,CAACd,QAAL,CAAc;AACTpB,cAAAA,eAAe,EAAE,MAAI,CAACF,KAAL,CAAWE,eAAX,CAA2B4B,GAA3B,CAA+B,UAAC8B,EAAD;AAAA,uBAASA,EAAE,CAAC9C,EAAH,KAAU6C,IAAI,CAAC7C,EAAhB,GACxC+C,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBF,EAAlB,EAAsB;AACrBxB,kBAAAA,IAAI,EAAE,IADe;AAErBF,kBAAAA,SAAS,EAAEyB,IAAI,CAACzB;AAFK,iBAAtB,CADwC,GAKtC0B,EAL8B;AAAA,eAA/B;AADR,aAAd;AASD;AACD,SAxBI,EAyBL;AAzBK,SA0BJvB,KA1BI,CA0BE,UAACC,GAAD,EAAS,CAEf,CA5BI,EA3BU,CAyDZ;AAEE;AACH;AAGF;AAEA;;;;AArNH;AAAA;AAAA,iCAwNeI,KAxNf,EAwNsB;AACnBA,MAAAA,KAAK,CAACC,cAAN;AACE,WAAKrB,QAAL,CAAc;AAACrB,QAAAA,WAAW,EAAEyC,KAAK,CAACqB,MAAN,CAAaC;AAA3B,OAAd;AACD,KA3NJ,CA4NI;;AA5NJ;AAAA;AAAA,6BAkOU;AAAA;;AAER,aACC,oBAAC,KAAD,CAAO,QAAP;AAAgB,QAAA,GAAG,EAAE,KAAKhD,KAAL,CAAWC,YAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEA;AAAK,QAAA,SAAS,EAAC,uBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAyB,KAAKD,KAAL,CAAWG,aAAX,CAAyB8C,IAAlD,MADF,CAFA,EAKA;AAAK,QAAA,SAAS,EAAC,gCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEC;AAAK,QAAA,SAAS,EAAC,wBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK,CAAC,KAAKjE,KAAL,CAAWuB,wBAAZ,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,KAAKvB,KAAL,CAAWE,eAAX,CAA2B4B,GAA3B,CAA+B,UAACxB,OAAD;AAAA,eACjC,oBAAC,OAAD;AAAS,UAAA,GAAG,EAAEA,OAAO,CAACQ,EAAtB;AAA0B,UAAA,OAAO,EAAIR,OAArC;AAA8C,UAAA,YAAY,EAAI,MAAI,CAACU,KAAL,CAAWC,YAAzE;AAAwF,UAAA,aAAa,EAAI,MAAI,CAACD,KAAL,CAAWG,aAApH;AAAmI,UAAA,yBAAyB,EAAE,MAAI,CAACP,yBAAnK;AAA8L,UAAA,mBAAmB,EAAE,MAAI,CAACb,mBAAxN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADiC;AAAA,OAA/B,CADF,CAFL,EASG;AAAK,QAAA,KAAK,EAAE;AAAEmE,UAAAA,KAAK,EAAC,MAAR;AAAgBC,UAAAA,KAAK,EAAE;AAAvB,SAAZ;AACS,QAAA,GAAG,EAAE,aAACP,EAAD,EAAQ;AAAE,UAAA,MAAI,CAAChE,WAAL,GAAmBgE,EAAnB;AAAwB,SADhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QATH,CAFD,EAgBC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAhBD,EAmBE;AAAM,QAAA,QAAQ,EAAE,KAAKjD,mBAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEE;AAAU,QAAA,SAAS,EAAC,uBAApB;AAA4C,QAAA,KAAK,EAAE,KAAKX,KAAL,CAAWC,WAA9D;AAA2E,QAAA,QAAQ,EAAE,KAAKQ,YAA1F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CADN,EAKM;AAAO,QAAA,SAAS,EAAC,mDAAjB;AAAqE,QAAA,IAAI,EAAC,QAA1E;AAAmF,QAAA,KAAK,EAAC,MAAzF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QALN,CAnBF,CALA,CADD;AAoCA;AAxQF;;AAAA;AAAA,EAAmChB,SAAnC;;IA2QM2E,O;;;;;AAEL,qBAAc;AAAA;;AAAA;AAEb;;;;6BACQ;AACR;AACA,UAAIC,MAAM,GAAG,EAAb,CAFQ,CAIR;;AACA,UAAIC,gBAAJ,CALQ,CAOR;;AACA,UAAI,CAAC,KAAKtD,KAAL,CAAWV,OAAX,CAAmB8B,IAAxB,EAA6B;AAC5BiC,QAAAA,MAAM,GAAG;AAAM,UAAA,KAAK,EAAE;AAACE,YAAAA,KAAK,EAAE,MAAR;AAAgBL,YAAAA,KAAK,EAAC,OAAtB;AAA+B,yBAAY;AAA3C,WAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAT;AACA,OAFD,CAIA;AAJA,WAKK,IAAG,KAAKlD,KAAL,CAAWV,OAAX,CAAmB8B,IAAnB,IAA2B,CAAC,KAAKpB,KAAL,CAAWV,OAAX,CAAmB6C,IAAlD,EAAwD;AAE5D;AACA,cAAInB,IAAI,GAAG,IAAIC,IAAJ,CAAS,KAAKjB,KAAL,CAAWV,OAAX,CAAmB4B,SAA5B,CAAX;AACCF,UAAAA,IAAI,GAAGA,IAAI,CAACwC,kBAAL,CAAwBC,SAAS,CAACC,QAAlC,EAA4C;AAACC,YAAAA,IAAI,EAAE,SAAP;AAAkBC,YAAAA,MAAM,EAAC;AAAzB,WAA5C,CAAP;AAEDP,UAAAA,MAAM,GAAG;AAAM,YAAA,KAAK,EAAE;AAACE,cAAAA,KAAK,EAAE,MAAR;AAAgBL,cAAAA,KAAK,EAAC,OAAtB;AAA+B,2BAAY;AAA3C,aAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAA2ElC,IAA3E,MAAT;AACA,SAPI,MASA,IAAG,KAAKhB,KAAL,CAAWV,OAAX,CAAmB8B,IAAnB,IAA2B,KAAKpB,KAAL,CAAWV,OAAX,CAAmB6C,IAAjD,EAAuD;AAE3D,cAAInB,KAAI,GAAG,IAAIC,IAAJ,CAAS,KAAKjB,KAAL,CAAWV,OAAX,CAAmBuE,SAA5B,CAAX;;AACC7C,UAAAA,KAAI,GAAGA,KAAI,CAACG,YAAL,EAAP;AACDkC,UAAAA,MAAM,GAAG;AAAM,YAAA,KAAK,EAAE;AAACE,cAAAA,KAAK,EAAE,MAAR;AAAgBL,cAAAA,KAAK,EAAC,OAAtB;AAA+B,2BAAY;AAA3C,aAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAA2ElC,KAA3E,MAAT;AACA,SA3BO,CA6BR;;;AACA,UAAInB,QAAQ,GAAG,KAAKG,KAAL,CAAWV,OAAX,CAAmB+C,WAAnB,GAAiC,KAAKrC,KAAL,CAAWV,OAAX,CAAmB+C,WAApD,GAAkE,IAAIpB,IAAJ,CAAS,KAAKjB,KAAL,CAAWV,OAAX,CAAmB4B,SAA5B,EAAuCC,YAAvC,EAAjF;;AAGA,UAAI,KAAKnB,KAAL,CAAWV,OAAX,CAAmB8C,YAAnB,IAAmC,KAAKpC,KAAL,CAAWjB,mBAAX,CAA+Bc,QAA/B,KAA4C,KAA/E,IAAwF,CAAC,KAAKG,KAAL,CAAWV,OAAX,CAAmB8B,IAAhH,EAAsH;AACrHkC,QAAAA,gBAAgB,GAAK;AAAK,UAAA,KAAK,EAAE;AAAC,0BAAc,QAAf;AAAyB,yBAAY;AAArC,WAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAA4DzD,QAA5D,MAArB;AAEA,aAAKG,KAAL,CAAWJ,yBAAX,CAAqCC,QAArC,EAA+C,KAAKG,KAAL,CAAWV,OAAX,CAAmBQ,EAAlE;AACA;;AACD,UAAI,KAAKE,KAAL,CAAWV,OAAX,CAAmB8B,IAAnB,IAA2B,KAAKpB,KAAL,CAAWjB,mBAAX,CAA+Bc,QAA/B,KAA6C,KAAKG,KAAL,CAAWV,OAAX,CAAmBQ,EAA/F,EAAmG;AAElGwD,QAAAA,gBAAgB,GAAG;AAAK,UAAA,KAAK,EAAE;AAAC,0BAAc,QAAf;AAAyB,yBAAY;AAArC,WAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAA4DzD,QAA5D,MAAnB;AACA;;AAEA,UAAI,KAAKG,KAAL,CAAWC,YAAX,CAAwBC,QAAxB,IAAoC,KAAKF,KAAL,CAAWV,OAAX,CAAmBF,eAA3D,EAA4E;AAE7E,eACE;AACA,8BAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACCkE,gBADD,EAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFA,EAGA;AAAI,YAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACE,KAAKtD,KAAL,CAAWC,YAAX,CAAwB6D,iBAD1B,EAEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFD,QADD,EAMC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACC;AAAM,YAAA,SAAS,EAAC,cAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACE,KAAK9D,KAAL,CAAWV,OAAX,CAAmBA,OADrB,CADD,EAIC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAJD,EAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YALD,EAOE+D,MAPF,CAND,CAHA;AAFF;AAyBC;;AAED,UAAI,KAAKrD,KAAL,CAAWG,aAAX,CAAyBD,QAAzB,IAAqC,KAAKF,KAAL,CAAWV,OAAX,CAAmBF,eAA5D,EAA6E;AAE7E,eACE;AACA,8BAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACCkE,gBADD,EAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFA,EAGA;AAAI,YAAA,SAAS,EAAC,qBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACC;AAAK,YAAA,KAAK,EAAE;AAACS,cAAAA,MAAM,EAAC,MAAR;AAAgBC,cAAAA,KAAK,EAAC;AAAtB,aAAZ;AAA2C,YAAA,GAAG,EAAE,KAAKhE,KAAL,CAAWG,aAAX,CAAyBX,eAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADD,EAEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFD,EAGE,KAAKQ,KAAL,CAAWG,aAAX,CAAyB8C,IAH3B,CADD,EAMC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACC;AAAM,YAAA,SAAS,EAAC,cAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACE,KAAKjD,KAAL,CAAWV,OAAX,CAAmBA,OADrB,CADD,EAIC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAJD,EAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YALD,EAME+D,MANF,CAND,CAHA;AAFF;AAwBC;AAED;;;;EAzGoB5E,S","sourcesContent":["import React, { Component } from 'react';\nexport class DirectMessage extends Component {\n\t constructor() {\n        super();\n\n        // Hash dates to display above first message of day to show date is displayed\n       this.first_message_dates = {};\n       \n\n       this.state = {\n       \t// Message to send\n       \tnew_message: \"\",\n\n       \t// List of Messages\n      \tdirect_messages: [],\n      \tmessages: [{sender_username: \t\t\"deepakabs\",\n      \t\t\t\tsentAt: \t\t\"Wed Nov 20, 2018 at 11\",\n      \t\t\t\tmessage: \t\t\"1\"\n      \t\t\t  }, \n      \t\t\t  {sender_username: \t\t    \"deepakabs\",\n      \t\t\t\tsenderName:\t\t\"Deepak ABS\",\n      \t\t\t\tprofile_img_url: \"abs\",\n      \t\t\t\tsentAt: \t\t\"Wed Nov 20, 2018 at 11\",\n      \t\t\t\tmessage: \t\t\"2\"\n      \t\t\t  }\n      \t\t\t  ,\n      \t\t\t  {sender_username: \t\t\"deepakabs\",\n      \t\t\t\tsenderName:\t\t\"Deepak ABS\",\n      \t\t\t\tprofile_img_url: \"abs\",\n      \t\t\t\tsentAt: \t\t\"Wed Nov 20, 2018 at 11\",\n      \t\t\t\tmessage: \t\t\"3\"\n      \t\t\t  }, \n      \t\t\t  {sender_username: \t\t    \"deepakabs\",\n      \t\t\t\tsenderName:\t\t\"Deepak ABS\",\n      \t\t\t\tprofile_img_url: \"abs\",\n      \t\t\t\tsentAt: \t\t\"Wed Nov 20, 2018 at 11\",\n      \t\t\t\tmessage: \t\t\"4\"\n      \t\t\t  }]\n      }\t\t  \n        \n        // Bind to class         \n        this.handleChange = this.handleChange.bind(this);\n    \tthis.send_direct_message = this.send_direct_message.bind(this);       \t\n    \tthis.update_first_message_date = this.update_first_message_date.bind(this);\n    }\n\n    /* @name:  \tupdate_first_message_date()\n\t\t@descr: Show first message with date \n    */\n  update_first_message_date(date_str, id) {\n   \tthis.first_message_dates[date_str] = id;\n\n  }\n    /* @name:  \tcomponentDidMount()\n\t\t@descr: fetch messages between selected user and current user\n    */\n   componentDidMount() {\n      // Show loading \n      this.scrollToBottom();\n\n    //  this.setState({fetching_direct_messages: true});\n\n      // Collect Messages\n      this.getDirectMessages(this.props.current_user.username, this.props.selected_user.username)\n      \n\n    } \n\n    /*\n    \t@name:getDirectMessages\n    \t@descr: Make GET request to getDirectMessages\n    */\n  \tgetDirectMessages(username1, username2) {\n\n\t\tthis.first_message_dates = {};\n   \n\t \tthis.setState({\n            fetching_direct_messages: true\n        });\n\t  let api = \"/api/getDirectMessages?username1=\"  + username1 + \"&username2=\" + username2;\n\t  return fetch(api)\n\t  .then(response =>  response.json())\n\t  .then((direct_messages) => {\n\n\n  \t\t// 2. Update firstMessageDay hash\n  \t\tlet  updated_direct_messages = direct_messages.map((dm) => {\n  \t\t\tlet date = new Date(dm.createdAt);\t\n  \t\t\tif (!this.first_message_dates[date.toDateString()])\n  \t\t\t\tthis.first_message_dates[date.toDateString()] = dm.id;\n  \t\t\tdm.sent = true;\n  \t\t\treturn dm;\n  \t\t});\n\n  \t\t// 3.Update state\n        this.setState({\n            direct_messages:     updated_direct_messages,\n            fetching_direct_messages: false\n        })\n        \n      })\n\t.catch((err) => {\n\t        this.setState({\n\t         \t//   direct_messages:     updated_direct_messages,\n\t            fetching_direct_messages: false\n\t        })\n\t    })  \n\n  \t}\n\n  \tcomponentWillReceiveProps(nextProps) {\n\n\t\tif (nextProps && nextProps.selected_user != undefined &&  nextProps.current_user != undefined) {\n\t\t\tif ((this.props.current_user.username != nextProps.current_user.username) || \n\t\t\t\t (this.props.selected_user.username != nextProps.selected_user.username))\n\t\t\t{\n\t\t\t\t // Collect Messages\n\t\t\t     this.getDirectMessages(nextProps.current_user.username, nextProps.selected_user.username)\n\t\t\t     \n\t\t\t}\n\t\t}\n\t  //this.scrollToBottom();\n\t}\n  \tcomponentDidUpdate(prevProps) {\n\t\t// if (prevProps && prevProps.selected_user != undefined &&  prevProps.current_user != undefined) {\n\t\t// \tif ((this.props.current_user.username != prevProps.current_user.username) || \n\t\t// \t\t (this.props.selected_user.username != prevProps.selected_user.username))\n\t\t// \t{\n\t\t// \t\t // Collect Messages\n\t\t// \t     this.getDirectMessages(this.props.current_user.username, this.props.selected_user.username)\n\t\t\t     \n\t\t// \t}\n\t\t// }\n\t  this.scrollToBottom();\n\t}\n\n\n    /* @name: send_direct_message \n       @descr: Send the message to the db and update the status\n    */ \n   send_direct_message(event) {\n   \t\tevent.preventDefault();\n   \t\tconsole.log(\"Nemam Amma Bhagavan Sharanam -- send_direct_message\", this.props.selected_user.username);\n    \t// 1. Create message object\n    \tvar date \t\t= new Date();\n    \tvar\tdate_str \t= date.toDateString();\n    \tvar message \t= this.state.new_message;\n        message = message.trim();\n        var direct_message = {};\n    \tif (message) {\n    \t\n    \t \tvar timestamp \t= date.getTime();\n     \t\t  \tdirect_message = {\n                            message:  message,\n                            sender_username:   this.props.current_user.username,\n                            id:       timestamp + \"_\" + this.props.current_user.username,   \n                            receiver_username: this.props.selected_user.username,\n\n                            // Boolean indicating if message is sent\n                            sent:   false,\n                           \tread: \tfalse,\n                            // Display date for the first message in a day\n                            display_date: !(date_str in this.first_message_dates) ? true : false,\n                            date_string:  date_str\n      \t\t};\n\n      \t\t// Update sent_dates_list\n      \t\tif (direct_message.display_date) {\n      \t\t\tconsole.log (\"Nemam Amma Bhagavan Sharanam -- setting first message date\");\n      \t\t\tthis.first_message_dates[date_str] = false;\n      \t\t}\n\n      \t\tthis.setState({\n\t    \t\tdirect_messages: [...this.state.direct_messages, direct_message]\n\t    \t});\n\n      \t\tfetch(\"/api/sendDirectMessage\", {\n\t\t\t  method: 'POST', // or 'PUT'\n\t\t\t  body: JSON.stringify({direct_message: direct_message}),\n\t\t\t  headers: {\n                \"Content-Type\": \"application/json\"\n            \t}\n\t\t\t})\n\t\t\t.then((response) =>response.json())\n\t\t\t.then((data) => {\n\n\t\t\t\tconsole.log(\"Nemam Amma Bhagavan Sharanam -- sent data\", data);\n\t\t\t\t// If message is delivered\n\t\t\t\tif (data.sent) {\n\t\t\t\t\t// Update message with status\n\t\t\t\t\t this.setState({\n\t\t\t\t\t      direct_messages: this.state.direct_messages.map((el) => (el.id === data.id) ?\n\t\t\t\t\t      \t\t\t\t\t\t\t\t\t\t\t\t\t\t  Object.assign({}, el, {\n\t\t\t\t\t      \t\t\t\t\t\t\t\t\t\t\t\t\t\t  \tsent: true,\n\t\t\t\t\t      \t\t\t\t\t\t\t\t\t\t\t\t\t\t  \tcreatedAt: data.createdAt\n\t\t\t\t\t      \t\t\t\t\t\t\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t      \t\t\t\t\t\t\t\t\t\t\t\t\t\t  : el)\n\t\t\t\t\t    });\t\n\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Don't modify the messages\n\t\t\t.catch((err) => {\n\n\t\t\t})\n\t    \t\n\t    \t// Save the new message in database\n      \t\t\n      \t\t// Update sent status \n  \t\t}\n\n\n  }\n\n   /* @name: handleChange: \n      @descr: Update text field when user modifies it\n \t*/\n \thandleChange(event) {\n \t event.preventDefault();\n   \t this.setState({new_message: event.target.value});\n  \t}\t\n    // Scroll to bottom\n    scrollToBottom = () => {\n\t  this.messagesEnd.scrollIntoView({ behavior: \"smooth\" });\n\t}\n\n\t\n\trender() {\n\n\t\treturn (\n\t\t\t<React.Fragment key={this.props.current_user}>\n\n\t\t\t<div className=\"direct-message-header\">\n\t\t\t\t\t<span> Send Message To  {this.props.selected_user.name} </span>\n\t\t\t</div>\n\t\t\t<div className=\"direct-message-history-wrapper\">\n\n\t\t\t\t<div className=\"direct-message-history\">\n\t\t\t\t \t  {!this.state.fetching_direct_messages &&\n\t\t\t\t \t   <div> \n\t\t\t\t \t   \t{this.state.direct_messages.map((message) => \n\t\t\t\t \t\t \t<Message key={message.id} message = {message} current_user = {this.props.current_user}  selected_user = {this.props.selected_user} update_first_message_date={this.update_first_message_date} first_message_dates={this.first_message_dates} > </Message>\n\t\t\t\t \t\t)}\n\t\t\t\t \t\t</div>\n\t\t\t\t \t}\n\t\n\t\t\t \t\t <div style={{ float:\"left\", clear: \"both\" }}\n\t\t\t             ref={(el) => { this.messagesEnd = el; }}>\n\t\t\t       \t </div>\n\t\t\t\t</div>\n\n\t\t\t\t<hr/>\n\n\n\t\t\t\t <form onSubmit={this.send_direct_message}>\n\t\t\t        <label>\n\n\t\t\t          <textarea className=\"send-message-textarea\" value={this.state.new_message} onChange={this.handleChange} />\n\t\t\t        </label>\n\t\t\t        <input className=\"mdl-button mdl-button--primary mdl-button--raised\" type=\"submit\" value=\"Send\" />\n\t\t\t      </form>\n\t\t\t</div>\n\t\t\t</React.Fragment>\n\n\t\t)\n\t}\n}\n\nclass Message extends Component {\n\t\t\n\tconstructor() {\n\t\tsuper();\n\t}\n\trender() {\n\t\t// Sending / Sent / Seen\n\t\tlet status = \"\";\n\t\n\t\t// If message is first\n\t\tvar firstMessageDate;\n\n\t\t// If message is sent\n\t\tif (!this.props.message.sent){\n\t\t\tstatus = <span style={{color: '#423', float:'right', 'font-size':'10px'}}> Sending... </span>\n\t\t}\n\t\t\n\t\t// If message is sent but unread\n\t\telse if(this.props.message.sent && !this.props.message.read) {\n\t\t\t\n\t\t\t// Convert Date to hours minutes\n\t\t\tlet date = new Date(this.props.message.createdAt);\n\t\t\t\tdate = date.toLocaleTimeString(navigator.language, {hour: '2-digit', minute:'2-digit'});\n\t\t\t\n\t\t\tstatus = <span style={{color: '#12B', float:'right', 'font-size':'10px'}}> Sent at {date} </span>\n\t\t}\n\n\t\telse if(this.props.message.sent && this.props.message.read) {\n\n\t\t\tlet date = new Date(this.props.message.updatedAt);\n\t\t\t\tdate = date.toDateString();\n\t\t\tstatus = <span style={{color: '#ACB', float:'right', 'font-size':'10px'}}> Seen at {date} </span>\n\t\t}\n\n\t\t// Display Date for First Message of Day\n\t\tlet date_str = this.props.message.date_string ? this.props.message.date_string : new Date(this.props.message.createdAt).toDateString();\n\n\n\t\tif (this.props.message.display_date && this.props.first_message_dates[date_str] == false && !this.props.message.sent) {\n\t\t\tfirstMessageDate =   <div style={{\"text-align\": 'center', 'font-size':'15px'}}> {date_str} </div>;\n\n\t\t\tthis.props.update_first_message_date(date_str, this.props.message.id);\n\t\t}\n\t\tif (this.props.message.sent && this.props.first_message_dates[date_str] ==  this.props.message.id) {\n\n\t\t\tfirstMessageDate = <div style={{\"text-align\": 'center', 'font-size':'15px'}}> {date_str} </div>;\n\t\t}\n\n\t \tif (this.props.current_user.username == this.props.message.sender_username) {\n\n\t\treturn (\n\t\t\t\t// If message is sent by user style it differently\n\t\t\t\t<React.Fragment>\n\t\t\t\t{firstMessageDate}\n\t\t\t\t<br/>\n\t\t\t\t<ul className=\"sent-message-ul\">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t{this.props.current_user.profile_image_url}\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\tYou\n\t\t\t\t\t</li>\n\t\t\t\t\t<li> \n\t\t\t\t\t\t<span className=\"sent-message\">\n\t\t\t\t\t\t\t{this.props.message.message}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t<br/>\n\n\t\t\t\t\t\t{status}\n\t\t\t\t\t</li>\n\t\t\t\t\n\t\t\t\t</ul>\t\t\n\t\t\t\t</React.Fragment>\n\t\t\t\t\n\t \t\t)\n\t\t}\n\n\t\tif (this.props.selected_user.username == this.props.message.sender_username) {\n\n\t\treturn (\n\t\t\t\t// If message is sent by user style it differently\n\t\t\t\t<React.Fragment>\n\t\t\t\t{firstMessageDate}\n\t\t\t\t<br/>\n\t\t\t\t<ul className=\"received-message-ul\">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<img style={{height:\"30px\", width:\"30px\"}} src={this.props.selected_user.profile_img_url}/>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t{this.props.selected_user.name}\n\t\t\t\t\t</li>\n\t\t\t\t\t<li> \n\t\t\t\t\t\t<span className=\"sent-message\">\n\t\t\t\t\t\t\t{this.props.message.message}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t{status}\n\t\t\t\t\t</li>\n\t\t\t\t\t\n\t\t\t\t</ul>\t\t\n\t\t\t\t</React.Fragment>\n\t\t\t\t\n\t \t\t)\n\t\t}\n\t\n\t}\t\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}